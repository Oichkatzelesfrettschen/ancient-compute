%% babbage-preamble.sty
%% Custom LaTeX package for Babbage whitepaper
%% arxiv.org compatible (PDFLaTeX, PDF figures)

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{babbage-preamble}[2025/10/31 Babbage Whitepaper Configuration]

%% ============================================================================
%% ARXIV-COMPATIBLE DOCUMENT SETUP
%% ============================================================================

% Use UTF-8 encoding
\RequirePackage[utf-8]{inputenc}
\RequirePackage[T1]{fontenc}

% Standard fonts (no exotic packages for arxiv)
\RequirePackage{lmodern}

%% ============================================================================
%% PAGE LAYOUT AND SPACING
%% ============================================================================

\RequirePackage[margin=1in]{geometry}
\RequirePackage{setspace}
\onehalfspacing

% Adjust line spacing for readability
\setlength{\parskip}{0.5ex plus 0.2ex minus 0.2ex}
\setlength{\parindent}{2em}

%% ============================================================================
%% MATH AND SCIENTIFIC NOTATION
%% ============================================================================

\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{mathtools}
\RequirePackage{physics}
\RequirePackage{siunitx}

% Configure siunitx for engineering notation
\sisetup{
    per-mode=symbol,
    separate-uncertainty=true,
    locale=UK
}

%% ============================================================================
%% TABLES AND TABULAR ENVIRONMENTS
%% ============================================================================

\RequirePackage{booktabs}
\RequirePackage{array}
\RequirePackage{multirow}
\RequirePackage{multicol}
\RequirePackage{colortbl}
\RequirePackage{tabularx}

% Define custom column types for tables
\newcolumntype{C}{>{\centering\arraybackslash}X}
\newcolumntype{R}{>{\raggedleft\arraybackslash}X}
\newcolumntype{L}{>{\raggedright\arraybackslash}X}

%% ============================================================================
%% GRAPHICS AND FIGURES (arxiv PDF-safe)
%% ============================================================================

\RequirePackage{graphicx}
\RequirePackage{tikz}
\RequirePackage{pgfplots}
\RequirePackage{pgfplotstable}

% Configure PGFPlots for publication quality
\pgfplotsset{
    compat=1.17,
    width=0.9\textwidth,
    height=6cm,
    scaled x ticks=false,
    scaled y ticks=false,
    legend pos=outer north east,
    grid=major,
    grid style={line width=0.5pt, gray, opacity=0.5},
    every axis label/.append style={font=\small},
    every tick label/.append style={font=\footnotesize}
}

% TikZ libraries for diagrams
\usetikzlibrary{
    shapes,
    arrows,
    arrows.meta,
    positioning,
    calc,
    patterns,
    decorations.pathmorphing,
    decorations.pathreplacing,
    shadows,
    backgrounds,
    fit,
    scopes,
    circuits,
    graphs
}

% Configure TikZ for consistent styling
\tikzset{
    block/.style={
        rectangle,
        draw=black,
        thick,
        fill=white,
        minimum width=2cm,
        minimum height=1cm,
        text centered,
        font=\small
    },
    decision/.style={
        diamond,
        draw=black,
        thick,
        fill=white,
        aspect=2,
        text centered,
        font=\small
    },
    io/.style={
        parallelogram,
        draw=black,
        thick,
        fill=blue!10,
        text centered,
        font=\small
    },
    process/.style={
        rectangle,
        draw=black,
        thick,
        fill=green!10,
        text centered,
        font=\small
    },
    component/.style={
        rectangle,
        draw=black!70,
        thick,
        fill=yellow!5,
        minimum width=1.5cm,
        minimum height=0.8cm,
        text centered,
        font=\tiny
    }
}

% Figure and table caption styling
\RequirePackage{caption}
\captionsetup{
    labelfont=bf,
    textfont=it,
    width=0.9\textwidth,
    margin=0.1cm
}

\RequirePackage{subcaption}

%% ============================================================================
%% HYPERLINKS AND REFERENCES
%% ============================================================================

\RequirePackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    citecolor=blue,
    urlcolor=blue,
    bookmarksnumbered=true,
    bookmarksopen=false
}

\RequirePackage{cleveref}
\crefname{figure}{figure}{figures}
\crefname{table}{table}{tables}
\crefname{section}{section}{sections}

%% ============================================================================
%% CODE AND TECHNICAL CONTENT
%% ============================================================================

\RequirePackage{listings}
\RequirePackage{xcolor}

% Define color scheme for code
\definecolor{codebackground}{gray}{0.95}
\definecolor{codekeyword}{rgb}{0, 0, 0.5}
\definecolor{codestring}{rgb}{0.6, 0, 0}
\definecolor{codecomment}{rgb}{0.5, 0.5, 0.5}

% Configure listings for assembly-like pseudocode
\lstset{
    basicstyle=\ttfamily\small,
    backgroundcolor=\color{codebackground},
    keywordstyle=\color{codekeyword}\bfseries,
    stringstyle=\color{codestring},
    commentstyle=\color{codecomment}\itshape,
    frame=single,
    framesep=5pt,
    framexleftmargin=5pt,
    linewidth=0.95\textwidth,
    breaklines=true,
    showstringspaces=false,
    extendedchars=true,
    inputencoding=utf8,
    keepspaces=true,
    numbers=left,
    numberstyle=\tiny\color{gray},
    stepnumber=5,
    tabsize=4
}

%% ============================================================================
%% SECTION AND CHAPTER FORMATTING
%% ============================================================================

\RequirePackage{titlesec}

\titleformat{\section}
    {\normalfont\Large\bfseries}
    {\thesection}
    {1em}
    {}
    [\vspace{0.5em}]

\titleformat{\subsection}
    {\normalfont\large\bfseries}
    {\thesubsection}
    {1em}
    {}

\titleformat{\subsubsection}
    {\normalfont\normalsize\bfseries}
    {\thesubsubsection}
    {1em}
    {}

% Spacing around sections
\titlespacing*{\section}{0pt}{3ex plus 1ex minus 0.2ex}{2ex plus 0.2ex}
\titlespacing*{\subsection}{0pt}{2.5ex plus 0.5ex minus 0.2ex}{1.5ex plus 0.2ex}
\titlespacing*{\subsubsection}{0pt}{2ex plus 0.5ex minus 0.2ex}{0.5ex plus 0.2ex}

%% ============================================================================
%% MISCELLANEOUS UTILITIES
%% ============================================================================

% Abstract formatting
\renewenvironment{abstract}
    {\section*{Abstract}\small}
    {\normalsize\par}

% Keywords
\newcommand{\keywords}[1]{%
    \vspace{1em}
    \noindent
    \textbf{Keywords:} #1
    \vspace{1em}
}

% Author affiliation
\newcommand{\affiliation}[1]{%
    \vspace{1em}
    \noindent
    #1
}

% Emphasis commands
\newcommand{\code}[1]{\texttt{#1}}
\newcommand{\var}[1]{\textit{#1}}
\newcommand{\const}[1]{\textsc{#1}}

% Citations
\RequirePackage[square,numbers,sort&compress]{natbib}
\bibliographystyle{plainnat}

% Ensure bibliography uses correct style
\renewcommand{\bibsection}{%
    \section*{\refname}
    \addcontentsline{toc}{section}{\refname}
}

%% ============================================================================
%% CUSTOM ENVIRONMENTS
%% ============================================================================

% Analysis box
\newenvironment{analysis}
    {\begin{quote}\small\itshape}
    {\end{quote}}

% Technical specification box
\newenvironment{specification}
    {\small\begin{tabular}{ll}}
    {\end{tabular}}

% Recommendation box
\newenvironment{recommendation}
    {\vspace{0.5em}\noindent\textbf{Recommendation:} \itshape}
    {\vspace{0.5em}}

%% ============================================================================
%% PDF OUTPUT OPTIMIZATION FOR ARXIV
%% ============================================================================

% Ensure proper PDF metadata
\RequirePackage[final]{pdfpages}

% Suppress overfull hbox warnings for title/author
\hfuzz=10pt

%% ============================================================================
%% FINAL PACKAGE DECLARATION
%% ============================================================================

\endinput
